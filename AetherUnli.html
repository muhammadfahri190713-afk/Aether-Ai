<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚óà AETHER</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--c:#00d4ff;--p:#bd00ff;--r:#ff0066;--b:#050508}
@keyframes f{0%,100%{transform:translateY(0)rotate(0deg)}50%{transform:translateY(-30px)rotate(5deg)}}
@keyframes r{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes g{0%,100%{box-shadow:0 0 30px var(--c),inset 0 0 30px rgba(0,212,255,.2)}50%{box-shadow:0 0 60px var(--p),inset 0 0 40px rgba(189,0,255,.3)}}
@keyframes p{0%,100%{opacity:.4}50%{opacity:1}}
@keyframes t{0%{transform:translateX(-100%)}100%{transform:translateX(100vw)}}
body{font-family:system-ui,sans-serif;background:var(--b);color:#fff;height:100vh;overflow:hidden}
.bg{position:fixed;inset:0;background:radial-gradient(circle at 30% 20%,rgba(0,212,255,.15)0%,transparent 50%),radial-gradient(circle at 70% 80%,rgba(189,0,255,.15)0%,transparent 50%),var(--b);z-index:-1}
.grid{position:fixed;inset:0;background-image:linear-gradient(rgba(0,212,255,.05)1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,.05)1px,transparent 1px);background-size:60px 60px;animation:r 120s linear infinite;opacity:.3;z-index:-1}
.line{position:fixed;top:0;left:0;width:100%;height:2px;background:linear-gradient(90deg,transparent,var(--c),transparent);animation:t 8s linear infinite;opacity:.6;z-index:100}
.app{max-width:100%;margin:0 auto;height:100vh;display:flex;flex-direction:column}
.header{padding:20px 40px;display:flex;align-items:center;gap:15px;border-bottom:1px solid rgba(0,212,255,.1)}
.menu{width:40px;height:40px;border:1px solid rgba(0,212,255,.3);background:rgba(0,212,255,.05);border-radius:10px;color:var(--c);cursor:pointer;transition:all .5s;display:flex;align-items:center;justify-content:center;font-size:18px}
.menu:hover{border-color:var(--c);box-shadow:0 0 20px rgba(0,212,255,.3);transform:rotate(90deg)}
.logo{width:45px;height:45px;position:relative;animation:f 6s ease-in-out infinite}
.ring{position:absolute;inset:0;border:2px solid transparent;border-top-color:var(--c);border-radius:50%;animation:r 8s linear infinite}
.ring:nth-child(2){inset:8px;border-top-color:var(--p);animation-duration:12s;animation-direction:reverse}
.ring:nth-child(3){inset:16px;border-top-color:var(--r);animation-duration:6s}
.core{position:absolute;inset:22px;background:linear-gradient(135deg,var(--c),var(--p));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;animation:g 4s ease-in-out infinite}
.title{font-size:22px;font-weight:800;background:linear-gradient(90deg,var(--c),var(--p));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.reset{margin-left:auto;padding:10px 16px;background:rgba(255,0,102,.1);border:1px solid rgba(255,0,102,.3);border-radius:10px;color:var(--r);cursor:pointer;font-size:13px;transition:all .5s}
.reset:hover{background:rgba(255,0,102,.2);box-shadow:0 0 20px rgba(255,0,102,.3)}
.sidebar{position:fixed;left:-350px;top:0;width:350px;height:100%;background:rgba(5,5,8,.95);border-right:1px solid rgba(0,212,255,.2);z-index:1000;transition:left .6s cubic-bezier(.4,0,.2,1);padding:25px}
.sidebar.active{left:0}
.side-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;padding-bottom:20px;border-bottom:1px solid rgba(255,255,255,.1)}
.side-title{color:var(--c);font-size:16px;letter-spacing:2px}
.close{width:35px;height:35px;border:none;background:rgba(255,255,255,.1);border-radius:8px;color:#fff;cursor:pointer;transition:all .5s;font-size:20px}
.close:hover{background:var(--r);transform:rotate(180deg)}
.new{width:100%;padding:15px;background:linear-gradient(135deg,var(--c),var(--p));border:none;border-radius:12px;color:#fff;font-weight:700;cursor:pointer;margin-bottom:20px;transition:all .5s;letter-spacing:1px}
.new:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(0,212,255,.4)}
.history{overflow-y:auto;height:calc(100% - 150px)}
.item{padding:15px;margin-bottom:10px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.05);border-radius:12px;cursor:pointer;transition:all .5s;position:relative;overflow:hidden}
.item:hover{background:rgba(0,212,255,.05);border-color:rgba(0,212,255,.2);transform:translateX(10px)}
.item.active{background:rgba(0,212,255,.1);border-left:3px solid var(--c)}
.item-name{font-weight:600;margin-bottom:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.item-date{font-size:11px;color:#666}
.actions{position:absolute;right:10px;top:50%;transform:translateY(-50%);display:flex;gap:5px;opacity:0;transition:all .5s}
.item:hover .actions{opacity:1}
.act{width:30px;height:30px;border:none;background:rgba(255,255,255,.1);border-radius:6px;color:#fff;cursor:pointer;transition:all .3s;font-size:12px}
.act:hover{background:var(--c);color:#000;transform:scale(1.2)}
.act.del:hover{background:var(--r);color:#fff}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:999;opacity:0;visibility:hidden;transition:all .5s}
.overlay.active{opacity:1;visibility:visible}
.chat{flex:1;overflow-y:auto;padding:0}
.welcome{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;animation:p 2s ease;padding:40px}
.wel-logo{width:120px;height:120px;position:relative;margin-bottom:30px}
.wel-logo .ring{border-width:3px}
.wel-logo .core{font-size:40px}
.welcome h1{font-size:40px;font-weight:800;margin-bottom:15px;background:linear-gradient(90deg,var(--c),#fff,var(--p));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.welcome p{color:#888;max-width:400px;line-height:1.6;margin-bottom:30px}
.quick{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.q{padding:12px 20px;background:rgba(0,212,255,.05);border:1px solid rgba(0,212,255,.2);border-radius:20px;color:#fff;cursor:pointer;transition:all .5s;font-size:13px}
.q:hover{background:rgba(0,212,255,.1);border-color:var(--c);transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,212,255,.2)}

/* FIX ALIGNMENT: User Kanan, AI Kiri */
.message{padding:30px 40px;border-bottom:1px solid rgba(255,255,255,.05);animation:p .8s ease;width:100%;display:flex;flex-direction:column}
.m-user{align-items:flex-end;text-align:right}
.m-ai{align-items:flex-start;text-align:left}
.message:hover{background:rgba(255,255,255,.02)}
.msg-header{display:flex;align-items:center;gap:12px;margin-bottom:15px}
.m-user .msg-header{flex-direction:row-reverse}
.msg-ava{width:35px;height:35px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:14px}
.user-ava{background:linear-gradient(135deg,var(--c),var(--p))}
.ai-ava{background:linear-gradient(135deg,var(--p),var(--r));animation:g 3s infinite}
.msg-name{font-weight:700;font-size:14px}
.msg-content{line-height:1.8;font-size:15px;max-width:80%;width:fit-content}
.m-ai .msg-content{padding-left:47px}
.m-user .msg-content{padding-right:47px}

.think{display:flex;align-items:center;gap:15px;padding:20px 0;color:var(--c)}
.t-orb{width:25px;height:25px;position:relative}
.t-orb .ring{border-width:2px}
.t-orb .core{inset:7px;font-size:8px}
.t-text{color:var(--c);font-size:13px;letter-spacing:2px;animation:p 2s infinite}
.code{margin:20px 0;border-radius:10px;overflow:hidden;border:1px solid rgba(0,212,255,.2);background:#0a0a0f;width:100%;text-align:left}
.code-h{padding:12px 20px;background:rgba(0,212,255,.05);display:flex;justify-content:space-between;align-items:center;font-size:12px;color:#888}
.copy{padding:6px 14px;background:rgba(255,255,255,.1);border:none;border-radius:5px;color:#fff;cursor:pointer;font-size:11px;transition:all .3s}
.copy:hover{background:var(--c);color:#000}
.code-c{padding:20px;overflow-x:auto;font-family:monospace;font-size:14px;line-height:1.8;color:#e0e0e0;background:#0a0a0f;width:100%}
.input{padding:20px 40px;border-top:1px solid rgba(0,212,255,.1);background:rgba(5,5,8,.8)}
.wrap{max-width:1200px;margin:0 auto;display:flex;align-items:flex-end;gap:10px;background:rgba(255,255,255,.05);border:1px solid rgba(0,212,255,.2);border-radius:20px;padding:10px;transition:all .5s}
.wrap:focus-within{border-color:var(--c);box-shadow:0 0 30px rgba(0,212,255,.1)}
textarea{flex:1;background:none;border:none;color:#fff;font-size:16px;resize:none;max-height:150px;padding:12px;outline:none;width:100%}
textarea::placeholder{color:#555}
.btn{width:45px;height:45px;border-radius:50%;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .5s}
.send{background:linear-gradient(135deg,var(--c),var(--p));color:#fff;box-shadow:0 0 20px rgba(0,212,255,.3)}
.send:hover{transform:scale(1.1)rotate(10deg)}
.pause{background:var(--r);color:#fff;animation:p 1s infinite}
.pause:hover{transform:scale(1.1)}
.sq{width:12px;height:12px;background:#fff;border-radius:2px}
.modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%)scale(.9);background:rgba(5,5,8,.98);border:1px solid rgba(0,212,255,.3);border-radius:20px;padding:25px;z-index:2000;opacity:0;visibility:hidden;transition:all .5s;min-width:300px}
.modal.active{opacity:1;visibility:visible;transform:translate(-50%,-50%)scale(1)}
.m-title{font-size:18px;font-weight:700;margin-bottom:5px}
.m-desc{color:#888;font-size:13px;margin-bottom:20px}
.m-inp{width:100%;padding:12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:10px;color:#fff;margin-bottom:20px;outline:none}
.m-inp:focus{border-color:var(--c)}
.m-btns{display:flex;gap:10px;justify-content:flex-end}
.mb{padding:10px 20px;border-radius:10px;border:none;cursor:pointer;font-size:13px;transition:all .3s}
.mb:hover{transform:translateY(-2px)}
.mb-ca{background:rgba(255,255,255,.1);color:#fff}
.mb-ok{background:linear-gradient(135deg,var(--c),var(--p));color:#fff}
.mb-del{background:var(--r);color:#fff}
.m-o{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:1999;opacity:0;visibility:hidden;transition:all .5s}
.m-o.active{opacity:1;visibility:visible}
::-webkit-scrollbar{width:8px}
::-webkit-scrollbar-thumb{background:rgba(0,212,255,.2);border-radius:4px}
::-webkit-scrollbar-track{background:transparent}
@media(max-width:768px){.header{padding:15px 20px}.message{padding:20px}.m-ai .msg-content, .m-user .msg-content{padding:0;max-width:100%}.input{padding:15px}}
</style>
</head>
<body>
<div class="bg"></div>
<div class="grid"></div>
<div class="line"></div>
<div class="overlay" id="ov" onclick="side()"></div>
<div class="m-o" id="mo" onclick="cm()"></div>
<div class="modal" id="md">
<div class="m-title" id="mt">Edit</div>
<div class="m-desc" id="mdc">Ubah nama chat</div>
<input type="text" class="m-inp" id="mi" placeholder="Nama...">
<div class="m-btns">
<button class="mb mb-ca" onclick="cm()">Batal</button>
<button class="mb mb-ok" id="mbt" onclick="doc()">Simpan</button>
</div>
</div>
<div class="sidebar" id="sb">
<div class="side-header">
<div class="side-title">‚óà SESSIONS</div>
<button class="close" onclick="side()">√ó</button>
</div>
<button class="new" onclick="n()">Ôºã NEW SESSION</button>
<div class="history" id="his"></div>
</div>
<div class="app">
<div class="header">
<button class="menu" onclick="side()">‚ò∞</button>
<div class="logo">
<div class="ring"></div>
<div class="ring"></div>
<div class="ring"></div>
<div class="core">‚óà</div>
</div>
<div class="title">AETHER</div>
<button class="reset" onclick="rs()">‚Üª Reset</button>
</div>
<div class="chat" id="cb">
<div class="welcome" id="wel">
<div class="wel-logo">
<div class="ring"></div>
<div class="ring"></div>
<div class="ring"></div>
<div class="core">‚óà</div>
</div>
<h1>AETHER AI</h1>
<p>We Use Technology Anti-Yapping With A Smart Thinking</p>
<div class="quick">
<div class="q" onclick="qk('Jelaskan quantum computing')">Quantum</div>
<div class="q" onclick="qk('Buatkan website portfolio')">Web Dev</div>
<div class="q" onclick="qk('Analisis tren AI 2024')">AI Trends</div>
<div class="q" onclick="qk('Bantu meditasi 5 menit')">Meditasi</div>
</div>
</div>
<div id="msg"></div>
<div id="th" style="display:none">
<div class="message m-ai">
<div class="msg-header">
<div class="msg-ava ai-ava">‚óà</div>
<div class="msg-name">AETHER</div>
</div>
<div class="msg-content">
<div class="think">
<div class="t-orb"><div class="ring"></div><div class="core">‚óà</div></div>
<span class="t-text">THINKING...</span>
</div>
</div>
</div>
</div>
</div>
<div class="input">
<div class="wrap">
<textarea id="in" placeholder="Ketik pesan..." rows="1" oninput="ar(this)" onkeydown="kd(event)"></textarea>
<button class="btn send" id="bt" onclick="se()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22,2 15,22 11,13 2,9 22,2"></polygon></svg>
</button>
</div>
</div>
</div>
<script>
const SYSTEM_PROMPT="Kamu adalah AETHER AI, ,";
let ct=null,id=Date.now(),ms=[],hs=[],mod='ed',tid=null;
window.onload=()=>{init()}
function init(){hs=JSON.parse(localStorage.getItem('at'))||[];n(false);rh()}
function n(s=true){id=Date.now();ms=[];document.getElementById('msg').innerHTML='';document.getElementById('wel').style.display='flex';if(s)sv()}
function side(){document.getElementById('sb').classList.toggle('active');document.getElementById('ov').classList.toggle('active');if(document.getElementById('sb').classList.contains('active'))rh()}
function rh(){const h=document.getElementById('his');h.innerHTML=hs.length?hs.slice().reverse().map(c=>`<div class="item ${c.id===id?'active':''}" onclick="lo(${c.id})"><div class="item-name">${es(c.n||'Untitled')}</div><div class="item-date">${fd(c.t)}</div><div class="actions" onclick="event.stopPropagation()"><button class="act" onclick="ren(${c.id})">‚úé</button><button class="act del" onclick="del(${c.id})">üóë</button></div></div>`).join(''):'<div style="text-align:center;padding:40px;color:#666">No sessions</div>'}
function lo(i){const c=hs.find(x=>x.id===i);if(c){id=i;ms=c.m||[];render();side()}}
function ren(i){tid=i;mod='ren';document.getElementById('mt').textContent='Rename';document.getElementById('mdc').textContent='Masukkan nama baru';document.getElementById('mi').value=hs.find(c=>c.id===i)?.n||'';om()}
function del(i){tid=i;mod='del';document.getElementById('mt').textContent='Hapus?';om()}
function rs(){mod='rs';document.getElementById('mt').textContent='Reset System?';om()}
function om(){document.getElementById('md').classList.add('active');document.getElementById('mo').classList.add('active')}
function cm(){document.getElementById('md').classList.remove('active');document.getElementById('mo').classList.remove('active')}
function doc(){if(mod==='ren'){const n=document.getElementById('mi').value.trim();if(n){const c=hs.find(x=>x.id===tid);if(c){c.n=n;localStorage.setItem('at',JSON.stringify(hs));rh()}}}else if(mod==='del'){hs=hs.filter(c=>c.id!==tid);localStorage.setItem('at',JSON.stringify(hs));if(id===tid)n(false);rh()}else if(mod==='rs'){localStorage.clear();location.reload()}cm()}
function sv(){const f=ms.find(m=>m.r==='u')?.c||'Untitled',n=f.slice(0,30),c={id:id,n:n,m:ms,t:Date.now()},i=hs.findIndex(x=>x.id===id);i>=0?hs[i]=c:hs.push(c);localStorage.setItem('at',JSON.stringify(hs))}

function render(){
    const b=document.getElementById('msg'),w=document.getElementById('wel');
    if(!ms.length){w.style.display='flex';b.innerHTML='';return}
    w.style.display='none';
    b.innerHTML=ms.map(m=>`
        <div class="message ${m.r==='u'?'m-user':'m-ai'}">
            <div class="msg-header">
                <div class="msg-ava ${m.r==='u'?'user-ava':'ai-ava'}">${m.r==='u'?'üë§':'‚óà'}</div>
                <div class="msg-name">${m.r==='u'?'Anda':'AETHER'}</div>
            </div>
            <div class="msg-content">${m.r==='u'?es(m.c):fo(m.c)}</div>
        </div>`).join('');
    sc();
}

function es(t){return t.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]))}
function fo(t){let f=es(t);f=f.replace(/```(\w+)?\n([\s\S]*?)```/g,(_,l,c)=>`<div class="code"><div class="code-h"><span>${l||'code'}</span><button class="copy" onclick="cp(this)">Copy</button></div><pre class="code-c"><code>${c.trim()}</code></pre></div>`);f=f.replace(/\*\*(.*?)\*\*/g,'<strong style="color:#fff">$1</strong>').replace(/\n/g,'<br>');return f}
function cp(b){const c=b.closest('.code').querySelector('code').innerText;navigator.clipboard.writeText(c);b.textContent='‚úì';setTimeout(()=>b.textContent='Copy',1500)}
function fd(t){const d=new Date(t),n=new Date(),diff=(n-d)/1000;return diff<60?'baru':Math.floor(diff/60)+'m'}
function ar(t){t.style.height='auto';t.style.height=Math.min(t.scrollHeight,150)+'px'}
function kd(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();se()}}
function qk(t){document.getElementById('in').value=t;se()}
function sc(){const b=document.getElementById('cb');b.scrollTop=b.scrollHeight}
function st(s){document.getElementById('th').style.display=s?'block':'none';if(s)sc()}
function ps(){const b=document.getElementById('bt');b.className='btn pause';b.innerHTML='<div class="sq"></div>';b.onclick=sp}
function sn(){const b=document.getElementById('bt');b.className='btn send';b.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22,2 15,22 11,13 2,9 22,2"></polygon></svg>';b.onclick=se}

async function se(){
    const i=document.getElementById('in'),t=i.value.trim();
    if(!t)return;
    ms.push({r:'u',c:t}); render(); i.value=''; i.style.height='auto'; sv();
    st(true); ps();
    ct=new AbortController();
    try{
        const r=await fetch('http://localhost:3000/api/chat',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({ text: t }),
            signal:ct.signal
        });
        const d=await r.json();
        ms.push({r:'a',c: d.reply || d.error || '‚óà Gagal merespon'});
        render(); sv();
    }catch(e){
        if(e.name!=='AbortError'){
            ms.push({r:'a',c:'‚ö†Ô∏è Gagal terhubung ke Termux. Pastikan server sudah jalan!'});
            render(); sv();
        }
    }finally{ st(false); sn(); ct=null; }
}
function sp(){if(ct){ct.abort();ms.push({r:'a',c:'‚óà Stopped'});render();sv();st(false);sn();ct=null}}
</script>
</body>
</html>